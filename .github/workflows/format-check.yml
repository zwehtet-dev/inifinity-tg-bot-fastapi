name: Format Check (Optional)

on:
  pull_request:
    branches: [ main, develop ]

jobs:
  format-check:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'

    - name: Install formatters
      run: |
        python -m pip install --upgrade pip
        pip install black isort

    - name: Check formatting with black
      id: black
      run: |
        black --check app || echo "needs_format=true" >> $GITHUB_OUTPUT
      continue-on-error: true

    - name: Check imports with isort
      id: isort
      run: |
        isort --check-only app || echo "needs_sort=true" >> $GITHUB_OUTPUT
      continue-on-error: true

    - name: Comment on PR if formatting needed
      if: steps.black.outputs.needs_format == 'true' || steps.isort.outputs.needs_sort == 'true'
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: '⚠️ **Code formatting needed**\n\nPlease run the following command before merging:\n```bash\nmake format\n```\n\nThis will auto-format your code with `black` and `isort`.'
          })

    - name: Summary
      run: |
        echo "### Format Check Results" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "ℹ️ This check is informational only and won't block your PR." >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "To format your code, run:" >> $GITHUB_STEP_SUMMARY
        echo '```bash' >> $GITHUB_STEP_SUMMARY
        echo 'make format' >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
